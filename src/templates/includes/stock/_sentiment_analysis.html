<!-- Sentiment Analysis Section -->
<div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">AI Sentiment Analysis</h2>
    </div>
    <div class="p-6">
        <div class="grid md:grid-cols-2 gap-6 mb-6">
            <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-lg">
                <h3 class="font-medium text-gray-900 dark:text-white mb-3">Overall Sentiment</h3>
                <div class="flex items-center justify-between">
                    <div class="relative w-24 h-24">
                        <svg class="w-full h-full" viewBox="0 0 36 36">
                            <path class="stroke-gray-200 dark:stroke-gray-600" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke-width="3"></path>
                            <path class="stroke-green-500" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831" fill="none" stroke-dasharray="75, 100" stroke-linecap="round" stroke-width="3" transform="rotate(90 18 18)"></path>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            {% set sentiment_score = ai_sentiment.overall_sentiment_rating|default(5, true) %}
                            {% if sentiment_score >= 7 %}
                                {% set sentiment_class = 'text-green-500' %}
                                {% set sentiment_text = 'Positive' %}
                            {% elif sentiment_score >= 4 %}
                                {% set sentiment_class = 'text-yellow-500' %}
                                {% set sentiment_text = 'Neutral' %}
                            {% else %}
                                {% set sentiment_class = 'text-red-500' %}
                                {% set sentiment_text = 'Negative' %}
                            {% endif %}
                            <p class="text-2xl font-bold {{ sentiment_class }}">{{ "%.1f"|format(sentiment_score) }}/10</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ sentiment_text }}</p>
                        </div>
                    </div>
                    <div class="ml-4 flex-1">
                        <p class="text-sm text-gray-600 dark:text-gray-300">
                            {% if ai_sentiment.reasoning %}
                                {{ ai_sentiment.reasoning }}
                            {% else %}
                                Analyzing recent market sentiment and news for {{ stock.symbol }}...
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 dark:bg-gray-700/50 p-5 rounded-lg">
                <h3 class="font-medium text-gray-900 dark:text-white mb-3">Key Topics</h3>
                <div class="flex flex-wrap gap-2">
                    {% if ai_sentiment and ai_sentiment.key_words %}
                        {% for keyword in ai_sentiment.key_words|slice(5) %}
                            {% set colors = ['green', 'blue', 'purple', 'yellow', 'red', 'indigo', 'pink', 'gray'] %}
                            {% set color = colors[loop.index0 % colors|length] %}
                            <span class="px-3 py-1 text-xs font-medium bg-{{ color }}-100 dark:bg-{{ color }}-900/50 text-{{ color }}-800 dark:text-{{ color }}-200 rounded-full">
                                {{ keyword }}
                            </span>
                        {% endfor %}
                    {% else %}
                        <span class="px-3 py-1 text-xs text-gray-500">Analyzing key topics...</span>
                    {% endif %}
                </div>
                <div class="mt-4">
                    <h4 class="text-sm font-medium text-gray-900 dark:text-white mb-2">Sentiment Trend</h4>
                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 w-full"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                        <span>30d ago</span>
                        <span>15d ago</span>
                        <span>Now</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
            <h3 class="font-medium text-gray-900 dark:text-white mb-3">Recent Sentiment Events</h3>
            <div class="space-y-4">
                {% if sentiment_events and sentiment_events|length > 0 %}
                    {% for event in sentiment_events %}
                        {% set is_positive = event.sentiment > 0 %}
                        <div class="flex items-start gap-3">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full {% if is_positive %}bg-green-100 dark:bg-green-900/50{% else %}bg-red-100 dark:bg-red-900/50{% endif %} flex items-center justify-center">
                                <span class="material-symbols-outlined text-{% if is_positive %}green{% else %}red{% endif %}-500 text-lg">
                                    {% if is_positive %}trending_up{% else %}trending_down{% endif %}
                                </span>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900 dark:text-white">{{ event.news_headline }}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">
                                    {{ event.time }}
                                    {% if event.sentiment is defined %}
                                        â€¢ Sentiment: {{ "%+.1f"|format(event.sentiment) }}
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <p class="text-sm text-gray-500 dark:text-gray-400">No recent sentiment events found.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
